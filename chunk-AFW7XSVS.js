import{b as O,c as $,d as H,e as P,f as U}from"./chunk-UUQCR2PH.js";import{b as W}from"./chunk-MQOW2MR6.js";import{B as L,C as _,D as j,E as M,F as D,G as V,H as v,I as B,J as z,M as N,O as A,b as Q,d as R,e as w,f as b,g as F,h as f,i as g,j as u,m,n as d,o as I,p as s,r,s as a,t as l,u as T,v as h,w as k,y as x,z as E}from"./chunk-DKTK7E62.js";var C=(()=>{class t{constructor(e){this.http=e}getPokedexRegionByPokedexUrl(e){return this.http.get(`${e}`)}static{this.\u0275fac=function(o){return new(o||t)(F(B))}}static{this.\u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var q={1:[1],2:[1],3:[1],4:[1],5:[1],6:[0,1,2],7:[0],8:[0,1,2],9:[0],10:[0,1,2]};var G=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=f({type:t,selectors:[["app-loading-spinner"]],standalone:!0,features:[_],decls:4,vars:0,consts:[[1,"flex","flex-col","fixed","inset-0","flex","items-center","justify-center","bg-black","z-50"],[1,"w-16","h-16","border-4","border-yellow-400","border-t-transparent","rounded-full","animate-spin"],[1,"text-white","mt-4"]],template:function(o,i){o&1&&(r(0,"div",0),l(1,"div",1),r(2,"h1",2),x(3,"It may take a few seconds"),a()())},dependencies:[v]})}}return t})();var K=Q(W());var Y=t=>({background:t});function Z(t,S){t&1&&l(0,"app-loading-spinner")}function ee(t,S){if(t&1){let e=T();r(0,"div",3),h("click",function(){let i=g(e).$implicit,n=k();return u(n.goToPokemonDetails(i.id))}),r(1,"app-sprite-for-each-pokemon",4),h("load",function(){let i=g(e).$implicit,n=k();return u(n.onSpriteLoaded(i.id))}),a(),r(2,"h1",5),x(3),a(),l(4,"app-pokemon-number",6),r(5,"app-pokemon-types",7),h("typesLoaded",function(i){g(e);let n=k();return u(n.onTypesLoaded(i))}),a()()}if(t&2){let e=S.$implicit;s("ngStyle",j(5,Y,e.cardBackground||"#fff")),m(),s("pokemonId",e.id),m(2),E(e.name),m(),s("pokemonId",e.id),m(),s("pokemonId",e.id)}}var ve=(()=>{class t{constructor(e,o,i,n){this.pokedexService=e,this.getRegionDetailsService=o,this.router=i,this.route=n}ngOnInit(){this.initializeValues()}initializeValues(){this.loading=!0,this.initialPokemonCount=300,this.remainingPokemons=[],this.pokemons=[],this._regionId=null,this.pokemonTypes=[],this.cardBackground="#fff",this.spritesLoaded=new Set,this.changeRoute()}loadPokemonsForEachRegion(){if(this._regionId===null)return;let e=q[this._regionId];this.getRegionDetailsService.getRegionPokedex(this._regionId,e).pipe(w(o=>{let i=o.map(n=>this.pokedexService.getPokedexRegionByPokedexUrl(n.url));return R(i)})).subscribe({next:o=>{let i=o.flatMap(n=>n.pokemon_entries.map(p=>{let c=p.pokemon_species.url,y=Number(c.split("/").filter(Boolean).pop());return{name:p.pokemon_species.name,url:c,id:y}})).filter((n,p,c)=>p===c.findIndex(y=>y.id===n.id));this.pokemons=i.slice(0,this.initialPokemonCount),this.remainingPokemons=i.slice(this.initialPokemonCount)},error:()=>{this.loading=!1,K.default.fire({icon:"error",title:"Oops...",html:"There was an error loading Pok\xE9mon from this Region.",theme:"dark"}).then(o=>{o.isConfirmed&&window.location.reload()})}})}changeRoute(){this.route.paramMap.subscribe(e=>{let o=Number(e.get("id"));o&&o!==this._regionId&&(this._regionId=o,this.loadPokemonsForEachRegion())})}onTypesLoaded(e){let{pokemonId:o,types:i}=e,n=this.pokemons.find(p=>p.id===o);n&&(n.cardBackground=this.calculateCardBackground(i))}calculateCardBackground(e){if(!e||e.length===0)return"#fff";let o=e.map(i=>$[i.type.name]??"#777");return o.length===1?o[0]:`linear-gradient(135deg, ${o.join(", ")})`}goToPokemonDetails(e){this._regionId!==null&&this.router.navigate(["pokemon",e],{relativeTo:this.route})}onSpriteLoaded(e){this.spritesLoaded.add(e),this.spritesLoaded.size>=Math.min(this.initialPokemonCount,this.pokemons.length)&&(this.loading=!1,this.loadRemainingPokemons())}loadRemainingPokemons(){if(!this.remainingPokemons.length)return;let o=this.remainingPokemons.splice(0,50);this.pokemons=[...this.pokemons,...o],this.remainingPokemons.length&&setTimeout(()=>this.loadRemainingPokemons(),100)}static{this.\u0275fac=function(o){return new(o||t)(d(C),d(P),d(A),d(N))}}static{this.\u0275cmp=f({type:t,selectors:[["app-pokedex-for-each-region"]],standalone:!0,features:[L([C,P]),_],decls:3,vars:2,consts:[[4,"ngIf"],[1,"flex","flex-wrap","justify-center","pt-6","pb-6","gap-6","px-1"],["class","flex flex-col items-center w-[100px] lg:w-[320px] lg:h-[400px] rounded-xl p-2 pb-4 transform transition-transform duration-200 hover:scale-105 font-bold",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","w-[100px]","lg:w-[320px]","lg:h-[400px]","rounded-xl","p-2","pb-4","transform","transition-transform","duration-200","hover:scale-105","font-bold",3,"click","ngStyle"],[1,"items-center",3,"load","pokemonId"],[1,"uppercase","gap-2","text-[0.8rem]","lg:text-[1.5rem]"],[3,"pokemonId"],[1,"flex","justify-center","items-center",3,"typesLoaded","pokemonId"]],template:function(o,i){o&1&&(I(0,Z,1,0,"app-loading-spinner",0),r(1,"div",1),I(2,ee,6,7,"div",2),a()),o&2&&(s("ngIf",i.loading),m(2),s("ngForOf",i.pokemons))},dependencies:[v,M,D,V,O,z,H,U,G]})}}return t})();export{ve as PokedexForEachRegionComponent};
