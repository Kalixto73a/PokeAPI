import{b as H,c as J,d as q,e as G}from"./chunk-3NMOOANI.js";import{a as F,b as Y}from"./chunk-MQOW2MR6.js";import{B,C as P,D as V,E as $,F as z,G as N,H as C,I,J as A,M as O,O as U,b as X,c as w,d as j,e as L,f,g,h,i as u,j as k,m,n as l,o as b,p as a,r,s,t as d,u as D,v as x,w as _,y as v,z as M}from"./chunk-DKTK7E62.js";var y=(()=>{class o{constructor(e){this.http=e}getPokedexRegionByPokedexUrl(e){return this.http.get(`${e}`)}static{this.\u0275fac=function(t){return new(t||o)(g(I))}}static{this.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var S=(()=>{class o{constructor(e){this.http=e}getRegionDetails(e){return this.http.get(`${F.apiUrl}/region/${e}`).pipe(w(t=>({id:t.id,name:t.name})))}getRegionPokedex(e,t){return this.http.get(`${F.apiUrl}/region/${e}`).pipe(w(i=>t.map(n=>i.pokedexes[n]).filter(Boolean)))}static{this.\u0275fac=function(t){return new(t||o)(g(I))}}static{this.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var K={1:[1],2:[1],3:[1],4:[1],5:[1],6:[0,1,2],7:[0],8:[0,1,2],9:[0],10:[0,1,2]};var Q=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=h({type:o,selectors:[["app-loading-spinner"]],standalone:!0,features:[P],decls:4,vars:0,consts:[[1,"flex","flex-col","fixed","inset-0","flex","items-center","justify-center","bg-black","z-50"],[1,"w-16","h-16","border-4","border-yellow-400","border-t-transparent","rounded-full","animate-spin"],[1,"text-white","mt-4"]],template:function(t,i){t&1&&(r(0,"div",0),d(1,"div",1),r(2,"h1",2),v(3,"It may take a few seconds"),s()())},dependencies:[C]})}}return o})();var W=X(Y());var oe=o=>({background:o});function ie(o,E){o&1&&d(0,"app-loading-spinner")}function ne(o,E){if(o&1){let e=D();r(0,"div",3),x("click",function(){let i=u(e).$implicit,n=_();return k(n.goToPokemonDetails(i.id))}),r(1,"app-sprite-for-each-pokemon",4),x("load",function(){let i=u(e).$implicit,n=_();return k(n.onSpriteLoaded(i.id))}),s(),r(2,"h1",5),v(3),s(),d(4,"app-pokemon-number",6),r(5,"app-pokemon-types",7),x("typesLoaded",function(i){u(e);let n=_();return k(n.onTypesLoaded(i))}),s()()}if(o&2){let e=E.$implicit;a("ngStyle",V(5,oe,e.cardBackground||"#fff")),m(),a("pokemonId",e.id),m(2),M(e.name),m(),a("pokemonId",e.id),m(),a("pokemonId",e.id)}}var ye=(()=>{class o{constructor(e,t,i,n){this.pokedexService=e,this.getRegionDetailsService=t,this.router=i,this.route=n}ngOnInit(){this.initializeValues()}initializeValues(){this.loading=!0,this.initialPokemonCount=300,this.remainingPokemons=[],this.pokemons=[],this._regionId=null,this.pokemonTypes=[],this.cardBackground="#fff",this.spritesLoaded=new Set,this.changeRoute()}loadPokemonsForEachRegion(){if(this._regionId===null)return;let e=K[this._regionId];this.getRegionDetailsService.getRegionPokedex(this._regionId,e).pipe(L(t=>{let i=t.map(n=>this.pokedexService.getPokedexRegionByPokedexUrl(n.url));return j(i)})).subscribe({next:t=>{let i=t.flatMap(n=>n.pokemon_entries.map(p=>{let c=p.pokemon_species.url,R=Number(c.split("/").filter(Boolean).pop());return{name:p.pokemon_species.name,url:c,id:R}})).filter((n,p,c)=>p===c.findIndex(R=>R.id===n.id));this.pokemons=i.slice(0,this.initialPokemonCount),this.remainingPokemons=i.slice(this.initialPokemonCount)},error:()=>{this.loading=!1,W.default.fire({icon:"error",title:"Oops...",html:"There was an error loading Pok\xE9mon from this Region.",theme:"dark"}).then(t=>{t.isConfirmed&&window.location.reload()})}})}changeRoute(){this.route.paramMap.subscribe(e=>{let t=Number(e.get("id"));t&&t!==this._regionId&&(this._regionId=t,this.loadPokemonsForEachRegion())})}onTypesLoaded(e){let{pokemonId:t,types:i}=e,n=this.pokemons.find(p=>p.id===t);n&&(n.cardBackground=this.calculateCardBackground(i))}calculateCardBackground(e){if(!e||e.length===0)return"#fff";let t=e.map(i=>J[i.type.name]??"#777");return t.length===1?t[0]:`linear-gradient(135deg, ${t.join(", ")})`}goToPokemonDetails(e){this._regionId!==null&&this.router.navigate(["pokemon",e],{relativeTo:this.route})}onSpriteLoaded(e){this.spritesLoaded.add(e),this.spritesLoaded.size>=Math.min(this.initialPokemonCount,this.pokemons.length)&&(this.loading=!1,this.loadRemainingPokemons())}loadRemainingPokemons(){if(!this.remainingPokemons.length)return;let t=this.remainingPokemons.splice(0,50);this.pokemons=[...this.pokemons,...t],this.remainingPokemons.length&&setTimeout(()=>this.loadRemainingPokemons(),100)}static{this.\u0275fac=function(t){return new(t||o)(l(y),l(S),l(U),l(O))}}static{this.\u0275cmp=h({type:o,selectors:[["app-pokedex-for-each-region"]],standalone:!0,features:[B([y,S]),P],decls:3,vars:2,consts:[[4,"ngIf"],[1,"flex","flex-wrap","justify-center","pt-6","pb-6","gap-6","px-1"],["class","flex flex-col items-center w-[100px] lg:w-[320px] lg:h-[400px] rounded-xl p-2 pb-4 transform transition-transform duration-200 hover:scale-105 font-bold",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","w-[100px]","lg:w-[320px]","lg:h-[400px]","rounded-xl","p-2","pb-4","transform","transition-transform","duration-200","hover:scale-105","font-bold",3,"click","ngStyle"],[1,"items-center",3,"load","pokemonId"],[1,"uppercase","gap-2","text-[0.8rem]","lg:text-[1.5rem]"],[3,"pokemonId"],[1,"flex","justify-center","items-center",3,"typesLoaded","pokemonId"]],template:function(t,i){t&1&&(b(0,ie,1,0,"app-loading-spinner",0),r(1,"div",1),b(2,ne,6,7,"div",2),s()),t&2&&(a("ngIf",i.loading),m(2),a("ngForOf",i.pokemons))},dependencies:[C,$,z,N,H,A,q,G,Q]})}}return o})();export{ye as PokedexForEachRegionComponent};
